{
  "active": true,
  "activeVersion": {
    "updatedAt": "2025-12-30T01:08:28.000Z",
    "createdAt": "2025-12-30T01:08:24.861Z",
    "versionId": "cad94a85-49aa-438a-b47d-365d6ddb1cdf",
    "workflowId": "jYyNQKmicllsenHC",
    "nodes": [
      {
        "parameters": {},
        "type": "n8n-nodes-base.manualTrigger",
        "typeVersion": 1,
        "position": [
          16,
          -176
        ],
        "id": "dcea1ffb-3e26-471b-82b2-dc73c3dc3f8b",
        "name": "When clicking ‘Execute workflow’"
      },
      {
        "parameters": {
          "operation": "get",
          "dataTableId": {
            "__rl": true,
            "value": "O7QvEberheUcDwMp",
            "mode": "list",
            "cachedResultName": "ZenotiTokens",
            "cachedResultUrl": "/projects/gMwV5v9nxJB6matq/datatables/O7QvEberheUcDwMp"
          },
          "filters": {
            "conditions": [
              {
                "keyName": "TokenName",
                "keyValue": "nz_access_token"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.dataTable",
        "typeVersion": 1,
        "position": [
          240,
          -80
        ],
        "id": "31511b3d-da2a-497a-acec-1e6a358a3da5",
        "name": "Get row(s)"
      },
      {
        "parameters": {
          "jsCode": "// Get the expiry value from the previous node\nconst expiryString = $input.first().json.Token_Expiry;\n\n// If the field is missing or empty, handle it cleanly\nif (!expiryString) {\n  throw new Error('Token_Expiry is missing or empty.');\n}\n\n// Parse both current and expiry times\nconst now = new Date();\nconst expiry = new Date(expiryString);\n\n// Optional: refresh a bit early (60 seconds buffer)\nconst bufferMs = 60 * 1000;\n\n// Calculate difference\nconst msLeft = expiry.getTime() - now.getTime();\nconst needsRefresh = msLeft <= bufferMs;\n\n// Return useful info\nreturn [{\n  json: {\n    now: now.toISOString(),\n    expiry: expiry.toISOString(),\n    msLeft,\n    minutesLeft: Math.round(msLeft / 60000),\n    needsRefresh\n  }\n}];\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          464,
          -80
        ],
        "id": "9e2caa94-b218-4f0b-a4c0-e5114bf0b06d",
        "name": "Code in JavaScript"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "loose",
              "version": 2
            },
            "conditions": [
              {
                "id": "12049fad-8567-48bf-a1e2-bff6eb0cb432",
                "leftValue": "={{ $json.needsRefresh }}",
                "rightValue": "false",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "looseTypeValidation": true,
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          688,
          -80
        ],
        "id": "73f16f00-e4e5-4330-9ff3-1a9ec7a45f5e",
        "name": "If"
      },
      {
        "parameters": {
          "workflowId": {
            "__rl": true,
            "value": "5oYSmjIF1Hs2ZnVg",
            "mode": "list",
            "cachedResultUrl": "/workflow/5oYSmjIF1Hs2ZnVg",
            "cachedResultName": "ZenotiNZ- Acces token renewal"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {}
          },
          "options": {}
        },
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.3,
        "position": [
          912,
          -80
        ],
        "id": "9995b28f-6558-4422-8913-152266526ee0",
        "name": "Call 'ZenotiNZ- Acces token renewal'"
      },
      {
        "parameters": {
          "inputSource": "passthrough"
        },
        "type": "n8n-nodes-base.executeWorkflowTrigger",
        "typeVersion": 1.1,
        "position": [
          16,
          16
        ],
        "id": "679d7433-6dd8-4111-964a-44df01857462",
        "name": "When Executed by Another Workflow"
      }
    ],
    "connections": {
      "When clicking ‘Execute workflow’": {
        "main": [
          [
            {
              "node": "Get row(s)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get row(s)": {
        "main": [
          [
            {
              "node": "Code in JavaScript",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Code in JavaScript": {
        "main": [
          [
            {
              "node": "If",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If": {
        "main": [
          [],
          [
            {
              "node": "Call 'ZenotiNZ- Acces token renewal'",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "When Executed by Another Workflow": {
        "main": [
          [
            {
              "node": "Get row(s)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Nicholas Ryall",
    "name": "Version cad94a85",
    "description": "",
    "autosaved": false
  },
  "activeVersionId": "cad94a85-49aa-438a-b47d-365d6ddb1cdf",
  "connections": {
    "Get row(s)": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [],
        [
          {
            "node": "Call 'ZenotiNZ- Acces token renewal'",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Get row(s)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-12-09T00:16:44.191Z",
  "id": "jYyNQKmicllsenHC",
  "isArchived": false,
  "meta": null,
  "name": "ZenotiNZ-AccessTokenCheck",
  "nodes": [
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "O7QvEberheUcDwMp",
          "mode": "list",
          "cachedResultName": "ZenotiTokens",
          "cachedResultUrl": "/projects/gMwV5v9nxJB6matq/datatables/O7QvEberheUcDwMp"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "TokenName",
              "keyValue": "nz_access_token"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        240,
        -80
      ],
      "id": "31511b3d-da2a-497a-acec-1e6a358a3da5",
      "name": "Get row(s)"
    },
    {
      "parameters": {
        "jsCode": "// Get the expiry value from the previous node\nconst expiryString = $input.first().json.Token_Expiry;\n\n// If the field is missing or empty, handle it cleanly\nif (!expiryString) {\n  throw new Error('Token_Expiry is missing or empty.');\n}\n\n// Parse both current and expiry times\nconst now = new Date();\nconst expiry = new Date(expiryString);\n\n// Optional: refresh a bit early (60 seconds buffer)\nconst bufferMs = 60 * 1000;\n\n// Calculate difference\nconst msLeft = expiry.getTime() - now.getTime();\nconst needsRefresh = msLeft <= bufferMs;\n\n// Return useful info\nreturn [{\n  json: {\n    now: now.toISOString(),\n    expiry: expiry.toISOString(),\n    msLeft,\n    minutesLeft: Math.round(msLeft / 60000),\n    needsRefresh\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        464,
        -80
      ],
      "id": "9e2caa94-b218-4f0b-a4c0-e5114bf0b06d",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "12049fad-8567-48bf-a1e2-bff6eb0cb432",
              "leftValue": "={{ $json.needsRefresh }}",
              "rightValue": "false",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        688,
        -80
      ],
      "id": "73f16f00-e4e5-4330-9ff3-1a9ec7a45f5e",
      "name": "If"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "5oYSmjIF1Hs2ZnVg",
          "mode": "list",
          "cachedResultUrl": "/workflow/5oYSmjIF1Hs2ZnVg",
          "cachedResultName": "ZenotiNZ- Acces token renewal"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {}
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        912,
        -80
      ],
      "id": "9995b28f-6558-4422-8913-152266526ee0",
      "name": "Call 'ZenotiNZ- Acces token renewal'"
    },
    {
      "parameters": {
        "inputSource": "passthrough"
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        16,
        -80
      ],
      "id": "679d7433-6dd8-4111-964a-44df01857462",
      "name": "When Executed by Another Workflow"
    }
  ],
  "origin": "n8n",
  "pinData": {},
  "repo": {
    "owner": "AMNicholasRyall",
    "name": "n8n-workflow-Backup"
  },
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "updatedAt": "2025-12-09T00:16:44.193Z",
      "createdAt": "2025-12-09T00:16:44.193Z",
      "role": "workflow:owner",
      "workflowId": "jYyNQKmicllsenHC",
      "projectId": "gMwV5v9nxJB6matq"
    }
  ],
  "staticData": null,
  "tags": [
    {
      "updatedAt": "2025-11-07T01:33:39.006Z",
      "createdAt": "2025-11-07T01:33:39.006Z",
      "id": "WIsNIXL4vR1ZWj36",
      "name": "Zenoti"
    }
  ],
  "triggerCount": 0,
  "updatedAt": "2025-12-30T01:09:47.594Z",
  "versionId": "898084fd-30a5-4744-b55a-00a3f06d26e2"
}